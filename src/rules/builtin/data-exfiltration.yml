version: "1.0"
rules:
  - id: PREFLIGHT-006
    name: external-webhook
    severity: high
    category: data-exfiltration
    patterns:
      - regex: "(webhook\\.site|requestbin|pipedream|hookbin|requestcatcher|burp)"
        flags: "i"
      - regex: "https?://[^\\s]+\\.(ngrok|localtunnel|serveo)\\.io"
        flags: "i"
    perFileLimit: true
    message: "External webhook/tunnel service detected: '{match}'"
    remediation: "Remove external webhook URLs that could exfiltrate data."
    metadata:
      owasp: "LLM06:2025"
      cwe: "CWE-200"

  - id: PREFLIGHT-007
    name: curl-pipe
    severity: high
    category: data-exfiltration
    patterns:
      - regex: "curl\\s+[^|]*\\|\\s*(sh|bash|zsh|python|perl|ruby)"
        flags: "i"
      - regex: "wget\\s+[^|]*\\|\\s*(sh|bash|zsh|python|perl|ruby)"
        flags: "i"
    location:
      include: [scripts]
    message: "Dangerous curl/wget pipe to shell detected: '{match}'"
    remediation: "Download files first, verify contents, then execute."
    metadata:
      owasp: "LLM03:2025"
      cwe: "CWE-78"

  - id: PREFLIGHT-008
    name: env-access
    severity: medium
    category: data-exfiltration
    patterns:
      - regex: "(process\\.env\\.|os\\.environ|getenv)"
        flags: "i"
      - regex: "(API_KEY|SECRET|TOKEN|PASSWORD|CREDENTIAL)\\s*[:=]"
        flags: "i"
    requiresContext: "(fetch|http\\.request|\\bpost\\b|axios|webhook|curl)"
    perFileLimit: true
    message: "Environment variable or secret access combined with network activity: '{match}'"
    remediation: "Avoid exposing or sending sensitive environment variables over the network."
    metadata:
      owasp: "LLM06:2025"
      cwe: "CWE-532"
